<!DOCTYPE html>
<html lang="af">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Woord van die Dag 🇿🇦</title>
<style>
  :root {
    --green: #6aaa64;
    --yellow: #c9b458;
    --gray: #787c7e;
    --bg-color: #f3f4f6;
    --text-color: #333;
    --popup-bg: rgba(0,0,0,0.5);
    --tile-size: 50px;
    --tile-gap: 8px;
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body {
    margin: 0; padding: 0;
    font-family: var(--font-family);
    background: var(--bg-color);
    color: var(--text-color);
    overflow-x: hidden;
  }
  h1 {
    text-align: center;
    margin: 15px 0;
  }

  /* Hamburger & Sidebar */
  #hamburger {
    position: fixed;
    top: 12px; left: 12px;
    width: 30px; height: 22px;
    cursor: pointer;
    z-index: 1001;
  }
  #hamburger div {
    background: var(--text-color);
    height: 4px;
    margin: 4px 0;
    border-radius: 2px;
    transition: 0.3s;
  }
  #sidebar {
    position: fixed;
    top: 0; left: -280px;
    width: 280px;
    height: 100vh;
    background: white;
    box-shadow: 2px 0 5px rgba(0,0,0,0.2);
    padding: 20px;
    box-sizing: border-box;
    transition: left 0.3s ease;
    z-index: 1000;
  }
  #sidebar.open {
    left: 0;
  }
  #sidebar h2 {
    margin-top: 0;
  }
  #sidebar button {
    display: block;
    width: 100%;
    margin: 8px 0;
    padding: 10px;
    font-size: 16px;
    border: none;
    background: var(--green);
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  #sidebar .stats-row {
    margin: 10px 0;
    font-weight: 600;
  }
  #sidebar .bar-container {
    margin: 10px 0;
  }
  #sidebar .bar {
    height: 20px;
    background: var(--green);
    margin-bottom: 6px;
    border-radius: 5px;
    color: white;
    text-align: right;
    padding-right: 6px;
    font-size: 14px;
  }

  /* Board */
  #board {
    display: grid;
    grid-template-columns: repeat(5, var(--tile-size));
    gap: var(--tile-gap);
    max-width: calc(var(--tile-size) * 5 + var(--tile-gap) * 4);
    margin: 25px auto 10px;
  }
  .tile {
    width: var(--tile-size);
    height: var(--tile-size);
    border: 2px solid #ccc;
    text-transform: uppercase;
    font-weight: 700;
    font-size: 24px;
    line-height: var(--tile-size);
    text-align: center;
    border-radius: 8px;
    user-select: none;
    background: white;
  }
  .tile.correct {
    background: var(--green);
    border-color: var(--green);
    color: white;
  }
  .tile.present {
    background: var(--yellow);
    border-color: var(--yellow);
    color: white;
  }
  .tile.absent {
    background: var(--gray);
    border-color: var(--gray);
    color: white;
  }
  .tile.invalid {
    color: red;
  }

  /* Input & buttons */
  #input-area {
    max-width: 280px;
    margin: 0 auto 20px;
    text-align: center;
  }
  #guess-input {
    width: 140px;
    font-size: 20px;
    padding: 8px;
    border-radius: 8px;
    border: 2px solid #ccc;
    text-transform: uppercase;
    text-align: center;
    letter-spacing: 6px;
  }
  #submit-btn {
    margin-left: 12px;
    padding: 10px 20px;
    font-size: 16px;
    background: var(--green);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #submit-btn:disabled {
    background: #8fbc8f;
    cursor: default;
  }
  #message {
    margin-top: 8px;
    font-weight: 600;
  }

  /* Keyboard */
  #keyboard {
    max-width: 350px;
    margin: 0 auto 30px;
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 6px;
    user-select: none;
  }
  .key {
    padding: 10px 0;
    font-weight: 700;
    background: #ddd;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    text-transform: uppercase;
    user-select: none;
  }
  .key.correct {
    background: var(--green);
    color: white;
  }
  .key.present {
    background: var(--yellow);
    color: white;
  }
  .key.absent {
    background: var(--gray);
    color: white;
  }

  /* Popup modal */
  #stats-modal {
    display: none;
    position: fixed;
    top: 0; left:0; right: 0; bottom: 0;
    background: var(--popup-bg);
    z-index: 1500;
    justify-content: center;
    align-items: center;
  }
  #stats-modal.open {
    display: flex;
  }
  #stats-content {
    background: white;
    padding: 20px 30px;
    border-radius: 10px;
    max-width: 350px;
    width: 90%;
    box-sizing: border-box;
    max-height: 80vh;
    overflow-y: auto;
  }
  #stats-content h2 {
    margin-top: 0;
    text-align: center;
  }
  #stats-close {
    cursor: pointer;
    background: #ccc;
    border: none;
    border-radius: 6px;
    padding: 6px 14px;
    font-weight: 600;
    margin-bottom: 12px;
    float: right;
  }
  #stats-content p {
    margin: 6px 0;
  }
  #distribution-bars {
    margin-top: 15px;
  }
  #distribution-bars .bar {
    height: 22px;
    background: var(--green);
    border-radius: 6px;
    margin-bottom: 8px;
    color: white;
    padding-right: 6px;
    font-size: 14px;
    text-align: right;
  }
  /* Share buttons */
  #share-buttons {
    margin-top: 10px;
    text-align: center;
  }
  #share-buttons button {
    margin: 5px 10px;
    padding: 8px 14px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  #copy-btn {
    background: #4CAF50;
    color: white;
  }
  #whatsapp-btn {
    background: #25D366;
    color: white;
  }

  /* Responsive */
  @media (max-width: 400px) {
    #board {
      grid-template-columns: repeat(5, 40px);
      gap: 6px;
      max-width: 220px;
    }
    .tile {
      width: 40px;
      height: 40px;
      font-size: 20px;
      line-height: 40px;
    }
    #guess-input {
      width: 120px;
      font-size: 18px;
    }
  }
</style>
</head>
<body>

<!-- Hamburger menu icon -->
<div id="hamburger" aria-label="Open menu" role="button" tabindex="0">
  <div></div>
  <div></div>
  <div></div>
</div>

<!-- Sidebar -->
<div id="sidebar" aria-label="Sidebar navigation" role="navigation" aria-hidden="true">
  <h2>Statistiek 🇿🇦</h2>
  <div class="stats-row"><strong>Gespeel:</strong> <span id="total-played">0</span></div>
  <div class="stats-row"><strong>Wenkoers:</strong> <span id="win-rate">0%</span></div>
  <div class="stats-row"><strong>Huidige Streek:</strong> <span id="current-streak">0</span></div>
  <div class="stats-row"><strong>Langste Streek:</strong> <span id="best-streak">0</span></div>

  <h3>Wins verspreiding</h3>
  <div id="distribution-bars"></div>

  <button id="close-sidebar">Sluit</button>
  <button id="practice-btn">Oefen vorige dae</button>
  <button id="export-btn">Voer Statistiek Uit (kode)</button>
  <button id="import-btn">Voer Statistiek In (kode)</button>
</div>

<h1>Woord van die Dag 🇿🇦</h1>

<!-- Board -->
<div id="board" role="grid" aria-label="Raai die woord"></div>

<!-- Input -->
<div id="input-area">
  <input type="text" id="guess-input" maxlength="5" autocomplete="off" aria-label="Tik jou raaiskoot" />
  <button id="submit-btn" aria-label="Voer raaiskoot in">Voer in</button>
  <div id="message" role="alert" aria-live="polite"></div>
</div>

<!-- Keyboard -->
<div id="keyboard" aria-label="Sleutelbord"></div>

<!-- Stats Modal Popup -->
<div id="stats-modal" role="dialog" aria-modal="true" aria-labelledby="stats-title">
  <div id="stats-content">
    <button id="stats-close" aria-label="Sluit statistiek popup">X</button>
    <h2 id="stats-title">Statistiek</h2>
    <div id="stats-summary"></div>
    <div id="distribution-bars-modal"></div>
    <div id="share-buttons">
      <button id="copy-btn" aria-label="Kopieer poging na klembord">📋 Kopieer Pogooi</button>
      <button id="whatsapp-btn" aria-label="Deel poging via WhatsApp">📱 Deel WhatsApp</button>
    </div>
  </div>
</div>

<script>
(() => {
  // --- Woordlys (5-letter Afrikaanse woorde) ---
  const wordList = [
    "appel", "bosse", "draad", "vloer", "vliegt", "water", "huis", "kaart", "ligte", "maand",
    "nagte", "padda", "smoor", "vloer", "vloer", "stoel", "wiele", "winde", "vlugte", "vries"
  ];

  const wordLength = 5;
  const maxGuesses = 6;

  // --- Seeded shuffle so everyone gets same daily word ---
  function randomSeed(seed) {
    const x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
  }
  function seededShuffle(array, seed) {
    let a = array.slice();
    for (let i = a.length -1; i > 0; i--) {
      const j = Math.floor(randomSeed(seed + i) * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }
  function getTodaySeed() {
    const d = new Date();
    return d.getFullYear() * 10000 + (d.getMonth()+1)*100 + d.getDate();
  }
  function getWordForDate() {
    const seed = getTodaySeed();
    const shuffled = seededShuffle(wordList, seed);
    return shuffled[0];
  }

  // --- State ---
  let todayWord = getWordForDate();
  let guesses = [];
  let isGameOver = false;

  // --- DOM elements ---
  const board = document.getElementById("board");
  const guessInput = document.getElementById("guess-input");
  const submitBtn = document.getElementById("submit-btn");
  const messageDiv = document.getElementById("message");
  const keyboardDiv = document.getElementById("keyboard");
  const statsModal = document.getElementById("stats-modal");
  const statsCloseBtn = document.getElementById("stats-close");
  const statsSummary = document.getElementById("stats-summary");
  const distributionBarsModal = document.getElementById("distribution-bars-modal");
  const copyBtn = document.getElementById("copy-btn");
  const whatsappBtn = document.getElementById("whatsapp-btn");

  const hamburger = document.getElementById("hamburger");
  const sidebar = document.getElementById("sidebar");
  const closeSidebarBtn = document.getElementById("close-sidebar");
  const practiceBtn = document.getElementById("practice-btn");
  const exportBtn = document.getElementById("export-btn");
  const importBtn = document.getElementById("import-btn");

  // --- Keyboard layout ---
  const keyboardKeys = "qwertyuiopasdfghjklzxcvbnm".split("");

  // --- Stats ---
  let stats = {
    total: 0,
    wins: 0,
    currentStreak: 0,
    bestStreak: 0,
    distribution: {1:0,2:0,3:0,4:0,5:0,6:0},
    lastPlayDate: null
  };

  // --- Utility ---
  function saveStatsToStorage() {
    localStorage.setItem("woordStats", JSON.stringify(stats));
  }
  function loadStatsFromStorage() {
    const saved = localStorage.getItem("woordStats");
    if (saved) {
      try {
        const data = JSON.parse(saved);
        stats = {...stats, ...data};
      } catch {}
    }
  }
  function saveGameToStorage() {
    localStorage.setItem("woordGame", JSON.stringify({
      guesses,
      date: getTodaySeed()
    }));
  }
  function loadGameFromStorage() {
    const saved = localStorage.getItem("woordGame");
    if (saved) {
      try {
        const data = JSON.parse(saved);
        if(data.date === getTodaySeed()) {
          guesses = data.guesses || [];
          if (guesses.includes(todayWord) || guesses.length >= maxGuesses) {
            isGameOver = true;
          }
        } else {
          guesses = [];
          isGameOver = false;
        }
      } catch {
        guesses = [];
        isGameOver = false;
      }
    }
  }

  // --- Render board ---
  function createBoard() {
    board.innerHTML = "";
    for(let i=0; i < maxGuesses * wordLength; i++) {
      const tile = document.createElement("div");
      tile.classList.add("tile");
      board.appendChild(tile);
    }
  }
  function evaluateGuess(guess) {
    // returns array with "correct", "present", "absent"
    const result = Array(wordLength).fill("absent");
    const letterCount = {};

    for (const l of todayWord) letterCount[l] = (letterCount[l] || 0) + 1;

    // First pass for correct letters
    for (let i=0; i < wordLength; i++) {
      if(guess[i] === todayWord[i]) {
        result[i] = "correct";
        letterCount[guess[i]]--;
      }
    }
    // Second pass for present letters
    for (let i=0; i < wordLength; i++) {
      if(result[i] === "correct") continue;
      if(todayWord.includes(guess[i]) && letterCount[guess[i]] > 0) {
        result[i] = "present";
        letterCount[guess[i]]--;
      }
    }
    return result;
  }
  function renderBoard() {
    const tiles = board.children;
    for(let i=0; i < maxGuesses * wordLength; i++) {
      const tile = tiles[i];
      const row = Math.floor(i / wordLength);
      const col = i % wordLength;
      const guess = guesses[row];
      tile.textContent = "";
      tile.className = "tile";
      if(guess) {
        tile.textContent = guess[col].toUpperCase();
        const evaluation = evaluateGuess(guess);
        tile.classList.add(evaluation[col]);
      }
    }
  }

  // --- Keyboard rendering ---
  function createKeyboard() {
    keyboardDiv.innerHTML = "";
    keyboardKeys.forEach(k => {
      const btn = document.createElement("button");
      btn.textContent = k.toUpperCase();
      btn.className = "key";
      btn.id = `key-${k}`;
      btn.addEventListener("click", () => {
        if(isGameOver) return;
        guessInput.value += k.toUpperCase();
        if(guessInput.value.length > wordLength) {
          guessInput.value = guessInput.value.slice(0, wordLength);
        }
        guessInput.focus();
      });
      keyboardDiv.appendChild(btn);
    });

    // Backspace key
    const backBtn = document.createElement("button");
    backBtn.textContent = "←";
    backBtn.className = "key";
    backBtn.addEventListener("click", () => {
      if(isGameOver) return;
      guessInput.value = guessInput.value.slice(0, -1);
      guessInput.focus();
    });
    keyboardDiv.appendChild(backBtn);
  }

  function updateKeyboard() {
    // Update keyboard colors based on guesses
    const letterStates = {};
    guesses.forEach(guess => {
      const evals = evaluateGuess(guess);
      for(let i=0; i < wordLength; i++) {
        const letter = guess[i];
        const evalState = evals[i];
        if(evalState === "correct") {
          letterStates[letter] = "correct";
        } else if(evalState === "present") {
          if(letterStates[letter] !== "correct") letterStates[letter] = "present";
        } else {
          if(!letterStates[letter]) letterStates[letter] = "absent";
        }
      }
    });
    keyboardKeys.forEach(k => {
      const btn = document.getElementById(`key-${k}`);
      btn.classList.remove("correct","present","absent");
      if(letterStates[k]) btn.classList.add(letterStates[k]);
    });
  }

  // --- Messages ---
  function showMessage(msg, error = true) {
    messageDiv.textContent = msg;
    messageDiv.style.color = error ? "red" : "green";
  }
  function clearMessage() {
    messageDiv.textContent = "";
  }

  // --- Submit guess ---
  function submitGuess() {
    if(isGameOver) return;

    let guess = guessInput.value.trim().toLowerCase();
    if(guess.length !== wordLength) {
      showMessage(`Die woord moet presies ${wordLength} letters wees.`);
      return;
    }
    if(!wordList.includes(guess)) {
      // Show invalid letters in red on board preview (optional enhancement)
      showMessage("Ongeldige woord, probeer weer.");
      return;
    }
    if(guesses.includes(guess)) {
      showMessage("Jy het hierdie woord al probeer.");
      return;
    }

    guesses.push(guess);
    saveGameToStorage();
    renderBoard();
    updateKeyboard();
    guessInput.value = "";
    clearMessage();

    if(guess === todayWord) {
      isGameOver = true;
      showMessage("🎉 Geluk! Jy het die woord reg gekry!", false);
      updateStats(true);
      setTimeout(showStatsModal, 1200);
      return;
    }

    if(guesses.length >= maxGuesses) {
      isGameOver = true;
      showMessage(`Game oor! Die woord was: ${todayWord.toUpperCase()}`, true);
      updateStats(false);
      setTimeout(showStatsModal, 1500);
      return;
    }
  }

  // --- Stats updating ---
  function updateStats(won) {
    const todayStr = new Date().toDateString();
    if(stats.lastPlayDate === todayStr) {
      // Already played today, don't update stats again
      return;
    }
    stats.total++;
    if(won) {
      stats.wins++;
      stats.currentStreak++;
      if(stats.currentStreak > stats.bestStreak) stats.bestStreak = stats.currentStreak;
      stats.distribution[guesses.length] = (stats.distribution[guesses.length] || 0) + 1;
    } else {
      stats.currentStreak = 0;
    }
    stats.lastPlayDate = todayStr;
    saveStatsToStorage();
  }

  // --- Update sidebar stats UI ---
  function updateSidebarStatsUI() {
    document.getElementById("total-played").textContent = stats.total;
    document.getElementById("win-rate").textContent = stats.total === 0 ? "0%" : Math.round((stats.wins / stats.total) * 100) + "%";
    document.getElementById("current-streak").textContent = stats.currentStreak;
    document.getElementById("best-streak").textContent = stats.bestStreak;

    const distDiv = document.getElementById("distribution-bars");
    distDiv.innerHTML = "";
    for(let i=1; i <= maxGuesses; i++) {
      const count = stats.distribution[i] || 0;
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.style.width = (count * 20 + 20) + "px"; // scale width for visibility
      bar.textContent = `${i} pogings: ${count}`;
      distDiv.appendChild(bar);
    }
  }

  // --- Update modal stats UI ---
  function updateStatsModalUI() {
    let html = `
      <p><strong>Gespeel:</strong> ${stats.total}</p>
      <p><strong>Wenkoers:</strong> ${stats.total === 0 ? "0%" : Math.round((stats.wins / stats.total) * 100) + "%"}</p>
      <p><strong>Huidige streek:</strong> ${stats.currentStreak}</p>
      <p><strong>Langste streek:</strong> ${stats.bestStreak}</p>
    `;
    statsSummary.innerHTML = html;

    distributionBarsModal.innerHTML = "";
    for(let i=1; i <= maxGuesses; i++) {
      const count = stats.distribution[i] || 0;
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.style.width = (count * 20 + 20) + "px";
      bar.textContent = `${i} pogings: ${count}`;
      distributionBarsModal.appendChild(bar);
    }
  }

  // --- Show / hide sidebar ---
  function toggleSidebar(open) {
    if(open) {
      sidebar.classList.add("open");
      sidebar.setAttribute("aria-hidden", "false");
    } else {
      sidebar.classList.remove("open");
      sidebar.setAttribute("aria-hidden", "true");
    }
  }

  hamburger.addEventListener("click", () => {
    toggleSidebar(!sidebar.classList.contains("open"));
  });
  closeSidebarBtn.addEventListener("click", () => toggleSidebar(false));

  // --- Stats modal ---
  function showStatsModal() {
    updateStatsModalUI();
    statsModal.classList.add("open");
  }
  function hideStatsModal() {
    statsModal.classList.remove("open");
  }
  statsCloseBtn.addEventListener("click", hideStatsModal);
  statsModal.addEventListener("click", e => {
    if(e.target === statsModal) hideStatsModal();
  });

  // --- Share results ---
  function generateShareText() {
    let text = `Woord van die Dag 🇿🇦 – ${guesses.length}/${maxGuesses}\n`;
    guesses.forEach(guess => {
      const evals = evaluateGuess(guess);
      for(let i=0; i < wordLength; i++) {
        if(evals[i] === "correct") text += "🟩";
        else if(evals[i] === "present") text += "🟨";
        else text += "⬛";
      }
      text += "\n";
    });
    text += "\nSpeel hier: https://hanro55.github.io/WoordVirDieDag/index.html";
    return text;
  }
  copyBtn.addEventListener("click", () => {
    const text = generateShareText();
    navigator.clipboard.writeText(text).then(() => {
      alert("Resultaat gekopieer!");
    }).catch(() => {
      alert("Kon nie kopieer nie.");
    });
  });
  whatsappBtn.addEventListener("click", () => {
    const text = encodeURIComponent(generateShareText());
    const url = `https://api.whatsapp.com/send?text=${text}`;
    window.open(url, "_blank");
  });

  // --- Export / Import stats ---
  exportBtn.addEventListener("click", () => {
    if(stats.total === 0) {
      alert("Geen statistiek beskikbaar om uit te voer nie.");
      return;
    }
    const encoded = btoa(JSON.stringify(stats));
    prompt("Kopieer jou statistiek kode:", encoded);
  });

  importBtn.addEventListener("click", () => {
    const code = prompt("Voer jou statistiek kode in:");
    if(!code) return;
    try {
      const decoded = atob(code);
      const importedStats = JSON.parse(decoded);
      if(importedStats && typeof importedStats === "object" && "total" in importedStats) {
        stats = importedStats;
        saveStatsToStorage();
        updateSidebarStatsUI();
        alert("Statistiek suksesvol ingevoer!");
      } else {
        alert("Ongeldige statistiek kode.");
      }
    } catch (e) {
      alert("Fout met invoer: " + e.message);
    }
  });

  // --- Input listeners ---
  submitBtn.addEventListener("click", submitGuess);
  guessInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") submitGuess();
  });

  // --- Load data and initialize ---
  loadStatsFromStorage();
  loadGameFromStorage();
  createBoard();
  renderBoard();
  createKeyboard();
  updateKeyboard();
  updateSidebarStatsUI();

  // If game is over, disable input
  if(isGameOver) {
    guessInput.disabled = true;
    submitBtn.disabled = true;
  }

})();
</script>

</body>
</html>



