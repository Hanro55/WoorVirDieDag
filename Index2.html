<!DOCTYPE html>
<html lang="af">
<head>
  <meta charset="UTF-8" />
  <title>Woord van die Dag</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --groen:#22c55e;   /* korrek */
      --geel:#eab308;    /* gedeel */
      --grys:#64748b;    /* verkeerd */
      --rand:#94a3b8;
      --prim:#3b82f6;    /* knoppies */
      --bg:#f8fafc;
      --txt:#222;
    }
    body {
      font-family: sans-serif;
      text-align: center;
      background: var(--bg);
      margin: 0;
      padding: 20px;
      color: var(--txt);
    }
    h1 { color: #334155; margin: 10px 0 0; }

    /* Bord */
    #bord {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      max-width: 300px;
      margin: 16px auto 10px;
    }
    .tegel {
      width: 100%;
      aspect-ratio: 1;
      border: 2px solid var(--rand);
      border-radius: 12px;
      font-size: 1.8em;
      text-transform: uppercase;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: background .2s, color .2s, border-color .2s, transform .08s;
    }
    .tegel.pop { transform: scale(1.06); }
    .korrek  { background-color: var(--groen); color: white; border: none; }
    .gedeel  { background-color: var(--geel);  color: white; border: none; }
    .verkeerd{ background-color: var(--grys);  color: white; border: none; }
    .ongeldig{ color: red; border-color: red; }

    /* Invoer & knoppies */
    #invoerblok { display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap: wrap; }
    input#raad-invoer {
      font-size: 1.2em;
      padding: 10px 12px;
      text-transform: uppercase;
      width: 160px;
      max-width: 90%;
    }
    button {
      padding: 10px 16px;
      font-size: 1em;
      margin-top: 8px;
      background-color: var(--prim);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button.secondary { background:#0ea5e9; }
    button:disabled { background: #94a3b8; cursor: not-allowed; }

    #boodskap {
      font-weight: bold;
      margin: 10px 0;
      min-height: 1.2em;
    }

    /* Sleutelbord */
    #sleutelbord {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
      max-width: 420px;
      margin: 10px auto 6px;
    }
    .sleutel {
      padding: 10px;
      background: #e2e8f0;
      border: none;
      font-weight: bold;
      border-radius: 6px;
      font-size: 1em;
      text-transform: uppercase;
    }
    .sleutel.korrek  { background: var(--groen); color: #fff; }
    .sleutel.gedeel  { background: var(--geel);  color: #fff; }
    .sleutel.verkeerd{ background: var(--grys);  color: #fff; }

    /* Stats + Grafiek blok */
    #stat-grafiek-wrap {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      margin-top: 14px;
      gap: 20px;
      flex-wrap: wrap;
    }
    #statistiek {
      font-size: 14px;
      color: #555;
      text-align: left;
      min-width: 260px;
      max-width: 320px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px;
    }
    #statistiek h3 { margin: 0 0 8px; color:#334155; }
    #statistiek ul { margin: 8px 0 0 18px; }
    #grafiek-kas {
      min-width: 320px;
      max-width: 420px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
    }
    #grafiek-kas h3 { margin: 0 0 8px; color:#334155; text-align:left; }
    #grafiek { width: 100%; height: 260px; }

    /* Onderste knoppies */
    #onder-knoppies { margin-top: 8px; display:flex; gap:8px; justify-content:center; flex-wrap: wrap; }

    /* Google Vorm */
    #vorm-seksie {
      max-width: 640px;
      margin: 28px auto 10px;
      padding: 10px;
    }
    #vorm-seksie h2 { text-align:center; font-family:sans-serif; margin: 0 0 10px; }
    #vorm-seksie iframe {
      width: 100%;
      height: 1000px;
      border: none;
      border-radius: 8px;
      background: #fff;
    }

    /* Responsief */
    @media (max-width: 420px){
      .tegel{ font-size: 1.5em; }
      #grafiek{ height: 220px; }
    }
  </style>
</head>
<body>
  <h1>Woord van die Dag</h1>

  <div id="bord"></div>

  <div id="invoerblok">
    <input id="raad-invoer" maxlength="5" placeholder="Tik 'n woord" autofocus />
    <button onclick="stuurRaaiskoot()">Voer in</button>
  </div>

  <div id="boodskap"></div>

  <div id="sleutelbord"></div>

  <div id="onder-knoppies">
    <button class="secondary" onclick="deelResultaat()">üì§ Deel jou poging</button>
    <button onclick="uitvoerStats()">‚¨áÔ∏è Voer statistiek uit</button>
    <button onclick="invoerStats()">‚¨ÜÔ∏è Laai statistiek in</button>
  </div>

  <div id="stat-grafiek-wrap">
    <div id="statistiek">
      <h3>Statistiek</h3>
      <p>Gespeel: <span id="s-gespeel">0</span></p>
      <p>Gewen: <span id="s-gewon">0</span></p>
      <p>Streek: <span id="s-streek">0</span></p>
      <p>Laas gespeel: <span id="s-laas">Nog nie</span></p>
      <div id="s-verdeling"></div>
    </div>

    <div id="grafiek-kas">
      <h3>Wen-verdeling</h3>
      <canvas id="grafiek"></canvas>
    </div>
  </div>

  <!-- Chart.js vir grafiek -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  let reedsGespeelVandag = false;

  const woordLys = [
    "awery", "awend", "avorm", "attar", "atoom", "atome", "atlas", "atjie", "aande"
  ];
  const maksimumPogings = 6;

  /** Pseudo-random generator met 'n seed gebaseer op datum **/
  function seededRandom(seed) {
    let x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
  }
  /** Shuffle wat elke dag dieselfde volgorde gee vir almal **/
  function shuffleArraySeeded(arr, seed) {
    let a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(seededRandom(seed + i) * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }
  /** Vandag se woord **/
  function kryVandagWoord() {
    const v = new Date();
    const s = v.getFullYear() + "-" + (v.getMonth()+1) + "-" + v.getDate();
    let seed = 0;
    for (let i = 0; i < s.length; i++) seed += s.charCodeAt(i);
    return shuffleArraySeeded(woordLys, seed)[0];
  }

  const teikenWoord = kryVandagWoord();

  // Pogings-stoor
  let pogings;
  const vandagSleutel = new Date().toDateString();
  if (localStorage.getItem("woordPogingsDatum") !== vandagSleutel) {
    localStorage.removeItem("woordPogings");
    localStorage.setItem("woordPogingsDatum", vandagSleutel);
    pogings = [];
  } else {
    pogings = JSON.parse(localStorage.getItem("woordPogings") || "[]");
  }

  const bord = document.getElementById("bord");
  const invoer = document.getElementById("raad-invoer");
  const boodskap = document.getElementById("boodskap");
  const sleutelbord = document.getElementById("sleutelbord");
  const letters = "qwertyuiopasdfghjklzxcvbnm";
  const sleutelStatus = {};

  // Stats DOM
  const sGespeel = document.getElementById("s-gespeel");
  const sGewon  = document.getElementById("s-gewon");
  const sStreek = document.getElementById("s-streek");
  const sLaas   = document.getElementById("s-laas");
  const sVerdeling = document.getElementById("s-verdeling");

  // Grafiek
  let chartRef = null;
  const grafiekCtx = document.getElementById("grafiek").getContext("2d");

  /* UI bou */
  function laaiBord() {
    bord.innerHTML = "";
    for (let i = 0; i < maksimumPogings * 5; i++) {
      const tegel = document.createElement("div");
      tegel.className = "tegel";
      bord.appendChild(tegel);
    }
  }

  function laaiSleutelbord() {
    sleutelbord.innerHTML = "";
    letters.split("").forEach(l => {
      const knoppie = document.createElement("button");
      knoppie.textContent = l;
      knoppie.className = "sleutel";
      knoppie.onclick = () => {
        if (invoer.value.length < 5) {
          invoer.value += l;
          updateLive();
        }
      };
      knoppie.id = "sleutel-" + l;
      sleutelbord.appendChild(knoppie);
    });
    const terug = document.createElement("button");
    terug.textContent = "‚Üê";
    terug.className = "sleutel";
    terug.onclick = () => { invoer.value = invoer.value.slice(0, -1); updateLive(); };
    sleutelbord.appendChild(terug);
  }

  // Live intik in huidige ry + rooi as ongeldig
  function updateLive() {
    const tegels = document.querySelectorAll(".tegel");
    const rowIndex = pogings.length;
    let woord = invoer.value.toLowerCase();

    for (let i = 0; i < 5; i++) {
      const idx = rowIndex * 5 + i;
      const t = tegels[idx];
      t.className = "tegel"; // reset
      t.textContent = woord[i] ? woord[i].toUpperCase() : "";
      if (woord && !woordLys.includes(woord) && woord[i]) {
        t.classList.add("ongeldig");
      }
      if (woord[i]) {
        t.classList.add("pop");
        setTimeout(() => t.classList.remove("pop"), 90);
      }
    }
  }

  // Verwerking van raaiskoot
  function stuurRaaiskoot() {
    if (reedsGespeelVandag) {
      boodskap.textContent = "Jy het reeds vandag gespeel!";
      return;
    }
    const raai = invoer.value.toLowerCase();
    if (raai.length !== 5) {
      boodskap.textContent = "Woord moet 5 letters wees.";
      return;
    }
    if (!woordLys.includes(raai)) {
      boodskap.textContent = "Woord is nie in die lys nie.";
      // laat rooi bly deur updateLive te roep
      updateLive();
      return;
    }
    if (pogings.length >= maksimumPogings) {
      boodskap.textContent = "Jy is uit pogings!";
      return;
    }

    pogings.push(raai);
    localStorage.setItem("woordPogings", JSON.stringify(pogings));
    werkBordOp();
    invoer.value = "";
    boodskap.textContent = "";

    if (raai === teikenWoord) {
      boodskap.textContent = "üéâ Reg geraai!";
      stoorStats(true);
    } else if (pogings.length === maksimumPogings) {
      boodskap.textContent = "‚ùå Uit pogings! Die woord was: " + teikenWoord.toUpperCase();
      stoorStats(false);
    } else {
      // aktiveer nuwe ry se live view
      updateLive();
    }
  }

  // Kleur logika met letter-count (geen ekstra geel/duplikaat)
  function werkBordOp() {
    const tegels = document.querySelectorAll(".tegel");
    pogings.forEach((woord, ry) => {
      const letterStatus = Array(5).fill("verkeerd");
      const letterCount = {};
      for (const l of teikenWoord) letterCount[l] = (letterCount[l] || 0) + 1;

      // eers korrek
      for (let i = 0; i < 5; i++) {
        if (woord[i] === teikenWoord[i]) {
          letterStatus[i] = "korrek";
          letterCount[woord[i]]--;
        }
      }
      // dan gedeel
      for (let i = 0; i < 5; i++) {
        if (letterStatus[i] === "korrek") continue;
        if (teikenWoord.includes(woord[i]) && letterCount[woord[i]] > 0) {
          letterStatus[i] = "gedeel";
          letterCount[woord[i]]--;
        }
      }
      // teken
      for (let i = 0; i < 5; i++) {
        const letter = woord[i];
        const tegel = tegels[ry * 5 + i];
        tegel.textContent = letter.toUpperCase();
        tegel.className = "tegel " + letterStatus[i];

        if (letterStatus[i] === "korrek") {
          sleutelStatus[letter] = "korrek";
        } else if (letterStatus[i] === "gedeel" && sleutelStatus[letter] !== "korrek") {
          sleutelStatus[letter] = "gedeel";
        } else if (!sleutelStatus[letter]) {
          sleutelStatus[letter] = "verkeerd";
        }
      }
    });
    werkSleutelbord();
  }

  function werkSleutelbord() {
    for (const [letter, status] of Object.entries(sleutelStatus)) {
      const knoppie = document.getElementById("sleutel-" + letter);
      if (knoppie) knoppie.className = "sleutel " + status;
    }
  }

  // Stats berg + wys
  function stoorStats(wen) {
    const datumSleutel = new Date().toDateString();
    let stats = JSON.parse(localStorage.getItem("woordStats") || "{}");
    if (!stats.pogingTelling) stats.pogingTelling = {};

    if (!stats.laaste || stats.laaste !== datumSleutel) {
      stats.gespeel = (stats.gespeel || 0) + 1;
      if (wen) {
        stats.wen = (stats.wen || 0) + 1;
        stats.streek = (stats.streek || 0) + 1;
        const pogingAantal = pogings.length;
        stats.pogingTelling[pogingAantal] = (stats.pogingTelling[pogingAantal] || 0) + 1;
      } else {
        stats.streek = 0;
      }
      stats.laaste = datumSleutel;
      localStorage.setItem("woordStats", JSON.stringify(stats));
    }
    wysStats();
  }

  function wysStats() {
    const stats = JSON.parse(localStorage.getItem("woordStats") || "{}");
    stats.pogingTelling = stats.pogingTelling || {};

    sGespeel.textContent = stats.gespeel || 0;
    sGewon.textContent   = stats.wen || 0;
    sStreek.textContent  = stats.streek || 0;
    sLaas.textContent    = stats.laaste || "Nog nie";

    // Lys "X keer gewen in Y poging(s)"
    let pogingData = "<ul>";
    for (let i = 1; i <= 6; i++) {
      const keer = stats.pogingTelling[i] || 0;
      pogingData += `<li>${keer} keer gewen in ${i} poging(s)</li>`;
    }
    pogingData += "</ul>";
    sVerdeling.innerHTML = pogingData;

    // Dag reeds gespeel lock
    const vandag = new Date().toDateString();
    if (stats.laaste === vandag) {
      reedsGespeelVandag = true;
      invoer.disabled = true;
      const voerInKnoppie = document.querySelector('button[onclick="stuurRaaiskoot()"]');
      if (voerInKnoppie) voerInKnoppie.disabled = true;
    }

    // Grafiek op sy sy (horizontale stawe)
    laaiGrafiek(stats.pogingTelling);
  }

  function laaiGrafiek(pogingTelling) {
    const labels = Array.from({length:6}, (_,i)=> `${i+1} pogings`);
    const data = labels.map((_,i)=> pogingTelling[i+1] || 0);

    // vernietig ou grafiek as hy bestaan
    if (chartRef) { chartRef.destroy(); }

    chartRef = new Chart(grafiekCtx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          data,
          // Elke kolom 'n ander kleur; eerste drie pas by te√´ls
          backgroundColor: [
            '#22c55e', /* groen */
            '#eab308', /* geel */
            '#64748b', /* grys */
            '#60a5fa', /* blou */
            '#a78bfa', /* pers */
            '#f472b6'  /* pienk */
          ]
        }]
      },
      options: {
        indexAxis: 'y',       // draai op sy sy
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { beginAtZero: true, ticks: { precision: 0 } }
        }
      }
    });
  }

  // Deel poging ‚Äì wys korrekte letters as HOOF, gedeel as klein, ander as _
  function deelResultaat() {
    let result = `Woord van die Dag üáøüá¶ ‚Äì ${pogings.length}/${maksimumPogings}\n`;
    pogings.forEach(woord => {
      for (let i = 0; i < 5; i++) {
        if (woord[i] === teikenWoord[i]) result += woord[i].toUpperCase();
        else if (teikenWoord.includes(woord[i])) result += woord[i].toLowerCase();
        else result += "_";
      }
      result += "\n";
    });
    navigator.clipboard.writeText(result);
    alert("Resultaat gekopieer!");
  }

  // Stats uitvoer/invoer via base64 (soos jou oorspronklike)
  function uitvoerStats() {
    const stats = localStorage.getItem("woordStats");
    if (!stats) { alert("Geen statistiek beskikbaar nie."); return; }
    const kode = btoa(stats);
    prompt("Jou stats-kode (kopieer en b√™re):", kode);
  }
  function invoerStats() {
    const kode = prompt("Voer stats-kode in:");
    if (!kode) return;
    try {
      const json = atob(kode);
      const data = JSON.parse(json);
      if (typeof data === "object" && data !== null && data.pogingTelling) {
        localStorage.setItem("woordStats", JSON.stringify(data));
        alert("Statistiek suksesvol ingevoer!");
        wysStats();
      } else {
        alert("Ongeldige stats-kode.");
      }
    } catch (e) {
      alert("Fout met invoer: " + e.message);
    }
  }

  // Inits
  laaiBord();
  laaiSleutelbord();
  wysStats();
  werkBordOp();
  updateLive();

  // Event: live intik
  invoer.addEventListener("input", updateLive);

  // Enter-stuur
  document.addEventListener("keydown", (e)=>{
    if (e.key === "Enter") stuurRaaiskoot();
  });
  </script>

  <!-- Google Vorm (bly dieselfde as jou oorspronklike) -->
  <section id="vorm-seksie">
    <h2>Kontakvorm</h2>
    <iframe
      src="https://docs.google.com/forms/d/e/1FAIpQLSd-AD5jz5QGziDojsHF2ILvAkt2oSWWfgvxuu0XBh-5mcbXjw/viewform?embedded=true"
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
      allowfullscreen>
    </iframe>
  </section>
</body>
</html>

